From 7a02eaa04e5645c869b2b8cf091f19c705c0eae1 Mon Sep 17 00:00:00 2001
From: Alejandro Enedino Hernandez Samaniego <alhe@linux.microsoft.com>
Date: Thu, 25 Feb 2021 14:06:54 -0700
Subject: [PATCH] retrying infinitely for az

Signed-off-by: Alejandro Enedino Hernandez Samaniego <alhe@linux.microsoft.com>
---
 bitbake/lib/bb/fetch2/wget.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/bitbake/lib/bb/fetch2/wget.py b/bitbake/lib/bb/fetch2/wget.py
index 492c709add..fe397d46b4 100644
--- a/bitbake/lib/bb/fetch2/wget.py
+++ b/bitbake/lib/bb/fetch2/wget.py
@@ -338,7 +338,10 @@ class Wget(FetchMethod):
                 return False
         except ConnectionResetError as e:
             if try_again:
-                logger.debug2(" CONNRESETcheckstatus: trying again %s " % uri)
+                logger.debug2(" CONNRESETcheckstatus: trying again %s :%s " % (e, uri))
+                if 'sstate.blob.core.windows.net' in uri:
+                    logger.debug2("Windows in URI, retrying infinitely")
+                    return self.checkstatus(fetch, ud, d, True)
                 return self.checkstatus(fetch, ud, d, False)
             else:
                 # debug for now to avoid spamming the logs in e.g. remote sstate searches
-- 
2.25.1

